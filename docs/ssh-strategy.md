# SSH Strategy

Personal SSH key management and configuration strategy.

## Overview

This document outlines the approach for managing SSH keys across multiple devices and services, balancing security with convenience.

## Key Management Strategy

### 1. Git Services (GitHub, GitLab, etc.)
**Method**: 1Password SSH Agent

- Primary SSH key stored in 1Password vault
- 1Password acts as SSH agent across all devices
- Biometric authentication required for each use
- Automatically synced across devices

**Benefits**:
- Set up once, works everywhere
- Encrypted vault storage
- Built-in backup
- Low friction for new devices

### 2. Homelab Infrastructure (Trusted Local Network)
**Method**: Shared SSH key in 1Password

- One key for all homelab devices (domain configured in `config/hosts.json`)
- Covers: Proxmox, TrueNAS, switches, APs, etc.
- Stored in 1Password, managed via 1Password SSH agent

**Benefits**:
- Simple management
- Synced across devices via 1Password
- Biometric authentication
- Easy to revoke if needed (regenerate and redeploy)

### 3. External Services (Seedbox, VPS, etc.)
**Method**: Separate key per service in 1Password

- Individual keys for each external/untrusted service
- Examples: `Seedbox SSH Key`, `VPS SSH Key`
- Stored in 1Password, managed via 1Password SSH agent

**Benefits**:
- Isolation - compromise of one service doesn't affect others
- Easy to revoke individual service access
- Clear security boundaries
- Synced across devices via 1Password

### 4. Special Devices (Steam Deck, etc.)
**Method**: Device-specific keys OR GitHub CLI

- Devices without easy 1Password support
- Generate device-specific key and add to GitHub
- Alternative: Use GitHub CLI (`gh`) for git authentication

## SSH Config Structure

SSH config is auto-generated by setup scripts using values from `config/hosts.json`. The 1Password SSH agent is used globally for all connections.

**macOS** uses the Unix socket:
```
IdentityAgent "~/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock"
```

**Windows** uses a named pipe:
```
IdentityAgent "\\.\pipe\openssh-ssh-agent"
```

Example config structure:
```ssh
# Git services
Host github.com
  HostName github.com
  User git

# Homelab servers (domain from config/hosts.json)
Host *.<homelab_domain>
  User <homelab_user>

# External services (individual keys in 1Password)
Host seedbox
  HostName seedbox.provider.com
  User myuser

# Default settings - 1Password agent for all connections
Host *
  AddKeysToAgent yes
  IdentityAgent "<platform-specific-path>"
```

## Key Inventory

All keys stored in 1Password (named after their target domain):
- `github.com` - Git services (GitHub, GitLab)
- Homelab domain - All homelab infrastructure
- Per-service keys for external services

## Setup Process

### Primary Devices (Mac, Windows)

1. Run the setup script (one-liner from README)
2. Enable 1Password SSH agent in settings
3. SSH config is auto-generated from `config/hosts.json`
4. Add public keys to respective services (GitHub, servers, etc.)

### Secondary Devices (Steam Deck, etc.)

1. Generate device-specific key
2. Add public key to GitHub with device label
3. Use simplified SSH config

## Security Considerations

**Trust Boundaries**:
- 1Password vault: High trust (all passwords stored here)
- Local homelab: High trust (physical security)
- External services: Lower trust (separate keys per service)

**Revocation Strategy**:
- GitHub: Remove key from GitHub settings
- Homelab: Regenerate and redeploy to all servers
- External: Regenerate specific key and update service

**Backup**:
- All keys backed up in 1Password vault

## Future Improvements

- [ ] Automated deployment of homelab public key to new servers
- [ ] SSH key rotation schedule
- [ ] Certificate-based authentication for homelab (advanced)
